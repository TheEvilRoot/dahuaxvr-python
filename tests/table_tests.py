import unittest

from dahuaxvr.table import TableBuilder


class TableTests(unittest.TestCase):

    def test_complex(self):
        complex_table = """
            table.Encode[0].CamInfo=SD 960H
            table.Encode[0].ExtraFormat[0].Audio.AudioSource=BNC
            table.Encode[0].ExtraFormat[0].Audio.BitRate=10
            table.Encode[0].ExtraFormat[0].Audio.Compression=G.711A
            table.Encode[0].ExtraFormat[0].Audio.Depth=16
            table.Encode[0].ExtraFormat[0].Audio.Frequency=8000
            table.Encode[0].ExtraFormat[0].Audio.Mode=0
            table.Encode[0].ExtraFormat[0].Audio.Pack=DHAV
            table.Encode[0].ExtraFormat[0].Audio.PacketPeriod=0
            table.Encode[0].ExtraFormat[0].AudioEnable=false
            table.Encode[0].ExtraFormat[0].Video.resolution=352x288
            table.Encode[0].ExtraFormat[0].Video.BitRate=320
            table.Encode[0].ExtraFormat[0].Video.BitRateControl=CBR
            table.Encode[0].ExtraFormat[0].Video.Compression=H.264
            table.Encode[0].ExtraFormat[0].Video.FPS=15
            table.Encode[0].ExtraFormat[0].Video.GOP=15
            table.Encode[0].ExtraFormat[0].Video.Height=288
            table.Encode[0].ExtraFormat[0].Video.Pack=DHAV
            table.Encode[0].ExtraFormat[0].Video.Profile=High
            table.Encode[0].ExtraFormat[0].Video.Quality=4
            table.Encode[0].ExtraFormat[0].Video.QualityRange=6
            table.Encode[0].ExtraFormat[0].Video.SVCTLayer=1
            table.Encode[0].ExtraFormat[0].Video.Width=352
            table.Encode[0].ExtraFormat[0].VideoEnable=true
            table.Encode[0].ExtraFormat[1].Audio.AudioSource=BNC
            table.Encode[0].ExtraFormat[1].Audio.BitRate=10
            table.Encode[0].ExtraFormat[1].Audio.Compression=G.711A
            table.Encode[0].ExtraFormat[1].Audio.Depth=16
            table.Encode[0].ExtraFormat[1].Audio.Frequency=8000
            table.Encode[0].ExtraFormat[1].Audio.Mode=0
            table.Encode[0].ExtraFormat[1].Audio.Pack=DHAV
            table.Encode[0].ExtraFormat[1].Audio.PacketPeriod=0
            table.Encode[0].ExtraFormat[1].AudioEnable=false
            table.Encode[0].ExtraFormat[1].Video.resolution=352x288
            table.Encode[0].ExtraFormat[1].Video.BitRate=320
            table.Encode[0].ExtraFormat[1].Video.BitRateControl=CBR
            table.Encode[0].ExtraFormat[1].Video.Compression=H.265
            table.Encode[0].ExtraFormat[1].Video.FPS=15
            table.Encode[0].ExtraFormat[1].Video.GOP=15
            table.Encode[0].ExtraFormat[1].Video.Height=288
            table.Encode[0].ExtraFormat[1].Video.Pack=DHAV
            table.Encode[0].ExtraFormat[1].Video.Profile=High
            table.Encode[0].ExtraFormat[1].Video.Quality=4
            table.Encode[0].ExtraFormat[1].Video.QualityRange=6
            table.Encode[0].ExtraFormat[1].Video.SVCTLayer=1
            table.Encode[0].ExtraFormat[1].Video.Width=352
            table.Encode[0].ExtraFormat[1].VideoEnable=true
            table.Encode[0].ExtraFormat[2].Audio.AudioSource=BNC
            table.Encode[0].ExtraFormat[2].Audio.BitRate=10
            table.Encode[0].ExtraFormat[2].Audio.Compression=G.711A
            table.Encode[0].ExtraFormat[2].Audio.Depth=16
            table.Encode[0].ExtraFormat[2].Audio.Frequency=8000
            table.Encode[0].ExtraFormat[2].Audio.Mode=0
            table.Encode[0].ExtraFormat[2].Audio.Pack=DHAV
            table.Encode[0].ExtraFormat[2].Audio.PacketPeriod=0
            table.Encode[0].ExtraFormat[2].AudioEnable=false
            table.Encode[0].ExtraFormat[2].Video.resolution=352x288
            table.Encode[0].ExtraFormat[2].Video.BitRate=320
            table.Encode[0].ExtraFormat[2].Video.BitRateControl=CBR
            table.Encode[0].ExtraFormat[2].Video.Compression=H.265
            table.Encode[0].ExtraFormat[2].Video.FPS=15
            table.Encode[0].ExtraFormat[2].Video.GOP=15
            table.Encode[0].ExtraFormat[2].Video.Height=288
            table.Encode[0].ExtraFormat[2].Video.Pack=DHAV
            table.Encode[0].ExtraFormat[2].Video.Profile=High
            table.Encode[0].ExtraFormat[2].Video.Quality=4
            table.Encode[0].ExtraFormat[2].Video.QualityRange=6
            table.Encode[0].ExtraFormat[2].Video.SVCTLayer=1
            table.Encode[0].ExtraFormat[2].Video.Width=352
            table.Encode[0].ExtraFormat[2].VideoEnable=true
            table.Encode[0].MainFormat[0].Audio.AudioSource=BNC
            table.Encode[0].MainFormat[0].Audio.BitRate=10
            table.Encode[0].MainFormat[0].Audio.Compression=G.711A
            table.Encode[0].MainFormat[0].Audio.Depth=16
            table.Encode[0].MainFormat[0].Audio.Frequency=8000
            table.Encode[0].MainFormat[0].Audio.Mode=0
            table.Encode[0].MainFormat[0].Audio.Pack=DHAV
            table.Encode[0].MainFormat[0].Audio.PacketPeriod=0
            table.Encode[0].MainFormat[0].AudioEnable=false
            table.Encode[0].MainFormat[0].Video.resolution=704x576
            table.Encode[0].MainFormat[0].Video.BitRate=1536
            table.Encode[0].MainFormat[0].Video.BitRateControl=VBR
            table.Encode[0].MainFormat[0].Video.Compression=H.264
            table.Encode[0].MainFormat[0].Video.FPS=25
            table.Encode[0].MainFormat[0].Video.GOP=50
            table.Encode[0].MainFormat[0].Video.Height=576
            table.Encode[0].MainFormat[0].Video.Pack=DHAV
            table.Encode[0].MainFormat[0].Video.Profile=High
            table.Encode[0].MainFormat[0].Video.Quality=6
            table.Encode[0].MainFormat[0].Video.QualityRange=6
            table.Encode[0].MainFormat[0].Video.SVCTLayer=1
            table.Encode[0].MainFormat[0].Video.Width=704
            table.Encode[0].MainFormat[0].VideoEnable=true
            table.Encode[0].MainFormat[1].Audio.AudioSource=BNC
            table.Encode[0].MainFormat[1].Audio.BitRate=10
            table.Encode[0].MainFormat[1].Audio.Compression=G.711A
            table.Encode[0].MainFormat[1].Audio.Depth=16
            table.Encode[0].MainFormat[1].Audio.Frequency=8000
            table.Encode[0].MainFormat[1].Audio.Mode=0
            table.Encode[0].MainFormat[1].Audio.Pack=DHAV
            table.Encode[0].MainFormat[1].Audio.PacketPeriod=0
            table.Encode[0].MainFormat[1].AudioEnable=false
            table.Encode[0].MainFormat[1].Video.resolution=704x576
            table.Encode[0].MainFormat[1].Video.BitRate=2048
            table.Encode[0].MainFormat[1].Video.BitRateControl=VBR
            table.Encode[0].MainFormat[1].Video.Compression=H.264
            table.Encode[0].MainFormat[1].Video.FPS=25
            table.Encode[0].MainFormat[1].Video.GOP=50
            table.Encode[0].MainFormat[1].Video.Height=576
            table.Encode[0].MainFormat[1].Video.Pack=DHAV
            table.Encode[0].MainFormat[1].Video.Profile=High
            table.Encode[0].MainFormat[1].Video.Quality=6
            table.Encode[0].MainFormat[1].Video.QualityRange=6
            table.Encode[0].MainFormat[1].Video.SVCTLayer=1
            table.Encode[0].MainFormat[1].Video.Width=704
            table.Encode[0].MainFormat[1].VideoEnable=true
            table.Encode[0].MainFormat[2].Audio.AudioSource=BNC
            table.Encode[0].MainFormat[2].Audio.BitRate=10
            table.Encode[0].MainFormat[2].Audio.Compression=G.711A
            table.Encode[0].MainFormat[2].Audio.Depth=16
            table.Encode[0].MainFormat[2].Audio.Frequency=8000
            table.Encode[0].MainFormat[2].Audio.Mode=0
            table.Encode[0].MainFormat[2].Audio.Pack=DHAV
            table.Encode[0].MainFormat[2].Audio.PacketPeriod=0
            table.Encode[0].MainFormat[2].AudioEnable=false
            table.Encode[0].MainFormat[2].Video.resolution=704x576
            table.Encode[0].MainFormat[2].Video.BitRate=2048
            table.Encode[0].MainFormat[2].Video.BitRateControl=VBR
            table.Encode[0].MainFormat[2].Video.Compression=H.264
            table.Encode[0].MainFormat[2].Video.FPS=25
            table.Encode[0].MainFormat[2].Video.GOP=50
            table.Encode[0].MainFormat[2].Video.Height=576
            table.Encode[0].MainFormat[2].Video.Pack=DHAV
            table.Encode[0].MainFormat[2].Video.Profile=High
            table.Encode[0].MainFormat[2].Video.Quality=6
            table.Encode[0].MainFormat[2].Video.QualityRange=6
            table.Encode[0].MainFormat[2].Video.SVCTLayer=1
            table.Encode[0].MainFormat[2].Video.Width=704
            table.Encode[0].MainFormat[2].VideoEnable=true
            table.Encode[0].SnapFormat[0].Video.resolution=704x576
            table.Encode[0].SnapFormat[0].Video.BitRate=32
            table.Encode[0].SnapFormat[0].Video.BitRateControl=CBR
            table.Encode[0].SnapFormat[0].Video.Compression=MJPG
            table.Encode[0].SnapFormat[0].Video.FPS=0.333333
            table.Encode[0].SnapFormat[0].Video.GOP=1
            table.Encode[0].SnapFormat[0].Video.Height=576
            table.Encode[0].SnapFormat[0].Video.Pack=DHAV
            table.Encode[0].SnapFormat[0].Video.Quality=6
            table.Encode[0].SnapFormat[0].Video.QualityRange=6
            table.Encode[0].SnapFormat[0].Video.SVCTLayer=1
            table.Encode[0].SnapFormat[0].Video.Width=704
            table.Encode[0].SnapFormat[0].VideoEnable=true
            table.Encode[0].SnapFormat[1].Video.resolution=704x576
            table.Encode[0].SnapFormat[1].Video.BitRate=32
            table.Encode[0].SnapFormat[1].Video.BitRateControl=CBR
            table.Encode[0].SnapFormat[1].Video.Compression=MJPG
            table.Encode[0].SnapFormat[1].Video.FPS=0.500000
            table.Encode[0].SnapFormat[1].Video.GOP=1
            table.Encode[0].SnapFormat[1].Video.Height=576
            table.Encode[0].SnapFormat[1].Video.Pack=DHAV
            table.Encode[0].SnapFormat[1].Video.Quality=6
            table.Encode[0].SnapFormat[1].Video.QualityRange=6
            table.Encode[0].SnapFormat[1].Video.SVCTLayer=1
            table.Encode[0].SnapFormat[1].Video.Width=704
            table.Encode[0].SnapFormat[1].VideoEnable=true
            table.Encode[0].SnapFormat[2].Video.resolution=352x288
            table.Encode[0].SnapFormat[2].Video.BitRate=32
            table.Encode[0].SnapFormat[2].Video.BitRateControl=CBR
            table.Encode[0].SnapFormat[2].Video.Compression=MJPG
            table.Encode[0].SnapFormat[2].Video.FPS=1.000000
            table.Encode[0].SnapFormat[2].Video.GOP=1
            table.Encode[0].SnapFormat[2].Video.Height=288
            table.Encode[0].SnapFormat[2].Video.Pack=DHAV
            table.Encode[0].SnapFormat[2].Video.Quality=4
            table.Encode[0].SnapFormat[2].Video.QualityRange=6
            table.Encode[0].SnapFormat[2].Video.SVCTLayer=1
            table.Encode[0].SnapFormat[2].Video.Width=352
            table.Encode[0].SnapFormat[2].VideoEnable=true
            table.Encode[37].MainFormat[0].Video.resolution=352x288
            table.Encode[37].MainFormat[0].Video.BitRate=1024
            table.Encode[37].MainFormat[0].Video.Compression=H.264
            table.Encode[37].MainFormat[0].Video.FPS=25
            table.Encode[37].MainFormat[0].Video.Height=288
            table.Encode[37].MainFormat[0].Video.Profile=High
            table.Encode[37].MainFormat[0].Video.Width=352
            table.Encode[37].MainFormat[0].VideoEnable=false
        """
        table = TableBuilder.parse(complex_table)
        assert len(table['table']['Encode']) == 2, len(table['table']['Encode'])
        assert len(table['table']['Encode'][0]['MainFormat']) == 3, len(table['table']['Encode'][0]['MainFormat'])
        assert len(table['table']['Encode'][0]['MainFormat'][0]['Video']) == 13, len(table['table']['Encode'][0]['MainFormat'][0]['Video'])

if __name__ == '__main__':
    unittest.main()